<!DOCTYPE html>
<html>
  <head>
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="shortcut icon" href="./images/favicon.ico">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<title>制服在庫管理</title>
</head>
<body>
	<div id="my_container">
		<div id="my_inner">
			<div>制服在庫管理</div>
			  <div id="my_quagga"></div>
			  <div id="my_result">***</div>
        <table>
          <tr>
            <td><button class="btn btn-primary" id="my_minus">-</button></td>
            <td>
              <div id="my_barcodeemp">
                <div id="my_barcode">
                <div>***</div>
              </div>
            </td>
            <td><button class="btn btn-info" id="my_plus">+</button></td>
          </tr>
        </table>
			</div>
		</div>
    <div>
      <div id="my_answer">
        <button class="btn btn-success" id="my_start">読取</button>
        <button class="btn btn-warning" id="my_stop">送信</button>
      </div>
		</div>
	</div>
</body>
<script src="//code.jquery.com/jquery-3.6.1.min.js"></script>
<script src="//unpkg.com/@ericblade/quagga2@1.7.4/dist/quagga.min.js"></script>
<script src="//cdn.jsdelivr.net/gh/mtaketani113/jquery-barcode@master/jquery-barcode.js"></script>
<script>
$("#my_start").click(()=>{
	console.log("Start!!");
	Quagga.init({
		inputStream: {
			name : "Live",
			type : "LiveStream",
			target: document.getElementById("my_quagga")
		},
		decoder: {
			readers: ["ean_reader"]
		}
	}, err=>{
		if(err){
			console.log(err);
			return;
		}
		console.log("Initialization finished!!");
		Quagga.start();
	});

	Quagga.onProcessed(result=>{
		if(result == null) return;
		if(typeof(result) != "object") return;
		if(result.boxes == undefined) return;
		const ctx = Quagga.canvas.ctx.overlay;
		const canvas = Quagga.canvas.dom.overlay;
		ctx.clearRect(0, 0, parseInt(canvas.width), parseInt(canvas.height));
		Quagga.ImageDebug.drawPath(result.box, 
			{x: 0, y: 1}, ctx, {color: "blue", lineWidth: 5});
	});

	Quagga.onDetected(result=>{
		console.log(result.codeResult.code);
		$("#my_result").text(result.codeResult.code);
		$("#my_barcode div").barcode(result.codeResult.code, "ean13");
	});
});

$("#my_stop").click(()=>{
	console.log("Stop!!");
	Quagga.stop();
});
</script>
<style scoop>

table{
margin:0 auto;
}

html, body{
	width: 100%;
  height: 100%;
	margin: 0px;
  padding: 0px;
}

#my_container{
	width: 100%;
  height: 600px;
	display: flex;
  flex-flow: wrap;
	justify-content: space-around;
	align-items: center;
}

#my_inner{
	margin: 0px;
  padding: 10px 10px;
	border-radius: 20px;
	background-color: gray;
  color: white;
	font-size: 2rem;
  text-align: center;
}

#my_quagga{
	width: 380px;
  height: 400px;
	/* margin: 5px; */
  padding: 0px;
	position: relative;
	background-color: silver;
}

#my_quagga video{
	width: 100%;
  height: 100%; 
	position: absolute;
	top: 0px; left: 0px;
}

#my_quagga canvas{
	width: 100%;
  height: 100%; 
	position: absolute;
	top: 0px; left: 0px;
}

#my_result{
	width: 100%;
  height: 100%; 
	font-size: 1rem;
  text-align: center;
}

#my_answer{
  margin:center;
}

#my_minus{
  margin-right: 80px;
  width: 50px;
  height: 50px;
}

#my_barcode{
	width: 100%;
  height: 100%;
	display: flex;
  flex-flow: wrap;
	justify-content: space-around;
	align-items: center;
}
#my_barcodeemp{
  /* width: 100px; */
  /* float: center; */
}

#my_plus{
  margin-left: 80px;
  width: 50px;
  height: 50px;
}

#my_start{
  width: 100px;
  height: 50px;
}

#my_stop{
  width: 100px;
  height: 50px;
}

</style>
</html>
